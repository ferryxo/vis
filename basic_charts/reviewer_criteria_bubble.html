
<!DOCTYPE html>
<html>
  <head>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.1.6.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  </head>
  <body>
    <div>
    <h3>Tooltip Chart</h3>
    <h5>Average scores obtained by students in the different criteria within a given rubric for selected assignment/project.</h5>
    </div>
    <script type="text/javascript">
    // Add a simple SVG element to the body of this document
      var svg = dimple.newSvg("body", 1000, 3000);

      // Create a dataset for 7 students and 5 criterions ( 35 avgscores)
      // studentData.content[0] -> mean scores for 0th student across all criteria
      // studentData.content[0][2] -> mean scores for 0th student for the 2nd criterion.
      var studentData = {

        "x_labels" : ["Criterion 1", "Criterion 2", "Criterion 3", "Criterion 4","Criterion 5" ],
        "y_labels" : ["Student1", "Student2", "Student3", "Student4", "Student5", "Student6", "Student7"],
        "content" :[
            [ 
                {"mean_score" : 50, "variance" : 217.5},
                {"mean_score" : 45, "variance" : 9154.799999999997},
                {"mean_score" : 67, "variance" : 23986.799999999996},
                {"mean_score" : 34, "variance" : 44624.85},
                {"mean_score" : 53, "variance" : 88406.30000000002},
            ], 
            [
                {"mean_score" : 50, "variance" : 161152.5},
                {"mean_score" : 4, "variance" : 278073},
                {"mean_score" : 34, "variance" : 161152.5},
                {"mean_score" : 2, "variance" : 278073},
                {"mean_score" : 80, "variance" : 278073}
            ],
            [
                {"mean_score" : 50, "variance" : 161152.5},
                {"mean_score" : 30, "variance" : 278073},
                {"mean_score" : 80, "variance" : 161152.5},
                {"mean_score" : 90, "variance" : 278073},
                {"mean_score" : 5, "variance" : 278073}
            ],
            [
                {"mean_score" : 10, "variance" : 161152.5},
                {"mean_score" : 0, "variance" : 278073},
                {"mean_score" : 0, "variance" : 161152.5},
                {"mean_score" : 0, "variance" : 278073},
                {"mean_score" : 0, "variance" : 278073}
            ],
            [
                {"mean_score" : 5, "variance" : 161152.5},
                {"mean_score" : 5, "variance" : 278073},
                {"mean_score" : 0, "variance" : 161152.5},
                {"mean_score" : 45, "variance" : 278073},
                {"mean_score" : 100, "variance" : 278073}
            ],
            [ 
                {"mean_score" : 50, "variance" : 217.5},
                {"mean_score" : 50, "variance" : 9154.799999999997},
                {"mean_score" : 50, "variance" : 23986.799999999996},
                {"mean_score" : 50, "variance" : 44624.85},
                {"mean_score" : 50, "variance" : 88406.30000000002},
            ], 
            [ 
                {"mean_score" : 50, "variance" : 217.5},
                {"mean_score" : 50, "variance" : 9154.799999999997},
                {"mean_score" : 50, "variance" : 23986.799999999996},
                {"mean_score" : 50, "variance" : 44624.85},
                {"mean_score" : 50, "variance" : 88406.30000000002},
            ]
        ]
      };


        // For a particular student, 4 reviewers gave scores for each of the 5 criteria
       // reviewdata.content[0][1][3] 0th student , 1st criteria, marks by 3rd reviewer
       var reviewdata = {

        "x_labels" : ["Criterion 1", "Criterion 2", "Criterion 3", "Criterion 4","Criterion 5" ],
        "y_labels" : ["Student1", "Student2", "Student3", "Student4", "Student5", "Student6", "Student7"],
        "z_labels" : [ "r1", "r2", "r3", "r4"],
        "configuration":{
            "color_scheme":{
                "negative_color" : {
                    "max" : "#B20C08",
                    "min" : "#F7977A"
                }, 
                "positive_color" : {
                    "max" : "#14AB6B",
                    "min" : "#4EE4A4"
                }, 
                "neutral_color" : {
                    "max" : "#F7977A",
                    "min" : "#F7977A"
                }
            },
            "circle" : {
                "min_size" : "10px", 
                "max_size" : "200px"
            }
        },
        "content" :[
            [ 
                [{"score": 100, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 99, "comment" : "" }, { "score": 93, "comment" : "" } ],
                [{"score": 0, "comment" : "" }, { "score": 1, "comment" : "" }, { "score": 1, "comment" : "" }, { "score": 3, "comment" : "" } ],
                [{"score": 100, "comment" : "" }, { "score": 0, "comment" : "" }, { "score": 10, "comment" : "" }, { "score": 40, "comment":""} ],
                [{"score": 19, "comment" : "" }, { "score": 9, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 6, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ]  
            ], 

            [ 

                [{"score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 89, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 90, "comment" : "" } ],
                [{"score": 40, "comment" : "" }, { "score": 35, "comment" : "" }, { "score": 32, "comment" : "" }, { "score": 28, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 10, "comment" : "" }, { "score": 9, "comment" : "" }, { "score": 13, "comment" : "" }, { "score": 8, "comment":""} ]
            ], 

            [ 
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 0, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ]
            ], 

            [ 
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 0, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ]
            ], 

            [ 
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 0, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ]
            ], 

            [ 
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 0, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ]
            ], 

            [ 
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 0, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" } ],
                [{"score": 60, "comment" : "" }, { "score": 85, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ],
                [{"score": 60, "comment" : "" }, { "score": 90, "comment" : "" }, { "score": 100, "comment" : "" }, { "score": 85, "comment":""} ]
            ], 

        ]
}


    var x_labels = [] ;
    var y_labels = [] ;
    var content = [] ;
    var processed_student_data = [] ;
    // var processed_scores_per_student = [] ;
    var processed_reviewer_data_per_student = {};

    d3.json("data.json", function(data){
        
        x_labels = reviewdata.x_labels;
        y_labels = reviewdata.y_labels;
        content = reviewdata.content;
        processed_student_data = processRawStudentData();
        processed_reviewer_data_per_student = processRawReviewerData();
        // The main chart
        var label = reviewdata.y_labels[0];
        // debugger;
        var myChart = new dimple.chart(svg, processed_reviewer_data_per_student[label]);

        // The chart to show in a tooltip
        var tipChart = null;
        // The other popup shapes
        var popup = null;
        // Position the main chart
        myChart.setBounds(50, 100, 800, 900);
      
        // Add the main chart axes
        var x = myChart.addCategoryAxis("x", "Criterion");
        x.title ="Criteria" ;
        var y = myChart.addCategoryAxis("y", "Reviewer");
        y.title = "Reviewers";
        var z = myChart.addMeasureAxis("z", "Score");
        myChart.addColorAxis("Score", [ "#F7977A", "#FFF79A", "#05834E"]);
        // myChart.addColorAxis("Standard Deviation", colors[0], colors[1], colors[2]);
          // Control bubble sizes by setting the max and min values    
     // z.overrideMin = 900;
     // z.overrideMax = 3000;
        var b = myChart.addSeries(null, dimple.plot.bubble);

        myChart.addLegend(180, 1, 360, 20, "right");

        myChart.draw();

        // setTimeout(function () {
        // svg.selectAll("circle")
        // .attr("opacity", 0.2)
        // .attr("r", 100);
        // }, 100);

        setTimeout(function () {
        svg.selectAll("circle")
        .attr("opacity", 0.2);
        }, 50);
    });


    function processRawStudentData(){
        
        var raw_student_data = studentData.content ;
        for( var i = 0; i < raw_student_data.length; i++ ){ //student
            for( var j = 0; j < raw_student_data[i].length; j++ ){ // criteria
                processed_student_data.push({
                    "Student": studentData.y_labels[i],
                    "Criterion" : studentData.x_labels[j],
                    "MeanScore" : raw_student_data[i][j].mean_score,
                    "Variance" : raw_student_data[i][j].variance
                });
            }
        }
      return processed_student_data;
    }
// reviewdata.content[0][1][3] 0th student , 1st criteria, marks by 3rd reviewer
    function processRawReviewerData(){
        var raw_review_data = reviewdata.content;
        var processed_scores_per_student ;

        for( var i = 0; i < raw_review_data.length; i++ ){ //student
                            processed_scores_per_student = [];

            for( var j = 0; j < raw_review_data[i].length; j++ ){ // criteria
                // processed_scores_per_student = [];

                for( var k = 0; k < raw_review_data[i][j].length; k++ ){ // reviewer
                    row = {} ;
                    row['Criterion'] = reviewdata.x_labels[j] ;
                    row['Reviewer'] = reviewdata.z_labels[k];
                    row['Score'] = raw_review_data[i][j][k].score ;
                    processed_scores_per_student.push(row);
                }
                // debugger;
                processed_reviewer_data_per_student[reviewdata.y_labels[i]] = processed_scores_per_student ;
            }
        }
  
        console.log(processed_reviewer_data_per_student);
        return processed_reviewer_data_per_student;
    }
     

    function get_avg_scores_for_each_criterion(scores_per_criterion){

        average_per_criterion = {} ;
        var sum = 0.0 ;
        var avg = 0.0 ;
        var keys  = Object.keys(scores_per_criterion); 
        var criterion_num = 0 ;

        for( var key in scores_per_criterion){
            var num = 0;    
            for( var i = 0 ; i < scores_per_criterion[key].length; i++){
                sum = sum + scores_per_criterion[key][i];
                num = i + 1;
            }
            avg = sum / num ;
            average_per_criterion[key] = avg ;
            reviewer_criteria_data_clone.content[criterion_num].push({"average": avg});
            criterion_num = criterion_num + 1 ;
        } 
        return average_per_criterion;
    }
    </script>
  </body>
</html>
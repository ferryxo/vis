<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
  <script type="text/javascript">

  </script>
</head>
<body>
<script type="text/javascript">

    var student_data = {

    "x_labels" : ["Criterion 1", "Criterion 2", "Criterion 3", "Criterion 4","Criterion 5", "Criterion 6", "Criterion 7"],
    "y_labels" : ["Student 1", "Student 2", "Student 3", "Student 4","Student 5","Student 6", "Student 7"],
    "color_scheme": {
        "color_1" : "",
        "color_2" : "", 
        "color_3" : ""
    },
    "mean_score_input" : "false",
    "content": [
        [{
            "score": 60,
            "mean_score": "1"
        }, {
            "score": 85,
            "mean_score": "2"
        }, {
            "score": 90,
            "mean_score": "3"
        }, {
            "score": 100,
            "mean_score": "4"
        }, {
            "score": 85,
            "mean_score": "5"
        }, {
            "score": 100,
            "mean_score": "6"
        }, {
            "score": 90,
            "mean_score": "7"
        }],
        [{
            "score": 20,
            "mean_score": "1"
        }, {
            "score": 25,
            "mean_score": "2"
        }, {
            "score": 10,
            "mean_score": "3"
        }, {
            "score": 40,
            "mean_score": "4"
        }, {
            "score": 23,
            "mean_score": "5"
        }, {
            "score": 97,
            "mean_score": "6"
        }, {
            "score": 10,
            "mean_score": "7"
        }],
        [{
            "score": 09,
            "mean_score": "1"
        }, {
            "score": 06,
            "mean_score": "2"
        }, {
            "score": 10,
            "mean_score": "3"
        }, {
            "score": 20,
            "mean_score": "4"
        }, {
            "score": 52,
            "mean_score": "5"
        }, {
            "score": 47,
            "mean_score": "6"
        }, {
            "score": 56,
            "mean_score": "7"
        }],
        [{
            "score": 78,
            "mean_score": "1"
        }, {
            "score": 65,
            "mean_score": "2"
        }, {
            "score": 75,
            "mean_score": "3"
        }, {
            "score": 49,
            "mean_score": "4"
        }, {
            "score": 25,
            "mean_score": "5"
        }, {
            "score": 75,
            "mean_score": "6"
        }, {
            "score": 34,
            "mean_score": "7"
        }],
        [{
            "score": 68,
            "mean_score": "1"
        }, {
            "score": 46,
            "mean_score": "2"
        }, {
            "score": 10,
            "mean_score": "3"
        }, {
            "score": 67,
            "mean_score": "4"
        }, {
            "score": 84,
            "mean_score": "5"
        }, {
            "score": 75,
            "mean_score": "6"
        }, {
            "score": 60,
            "mean_score": "7"
        }],
        [{
            "score": 39,
            "mean_score": "1"
        }, {
            "score": 45,
            "mean_score": "2"
        }, {
            "score": 78,
            "mean_score": "3"
        }, {
            "score": 93,
            "mean_score": "4"
        }, {
            "score": 65,
            "mean_score": "5"
        }, {
            "score": 75,
            "mean_score": "6"
        }, {
            "score": 40,
            "mean_score": "7"
        }],
        [{
            "score": 30,
            "mean_score": "1"
        }, {
            "score": 35,
            "mean_score": "2"
        }, {
            "score": 16,
            "mean_score": "3"
        }, {
            "score": 79,
            "mean_score": "4"
        }, {
            "score": 92,
            "mean_score": "5"
        }, {
            "score": 75,
            "mean_score": "6"
        }, {
            "score": 60,
            "mean_score": "7"
        }]
    ]
};


  /*
    and pass the contents of it to the draw function
    */
  // Add a simple SVG element to the body of this document
    var svg = dimple.newSvg("body", 800, 600);
    var data;
    var x_labels = [] ;
    var y_labels = [] ;
    var content = [] ;
    var scores_per_student = {} ;
    var average_per_student = [] ;
    var variance_per_student = [] ;
    var colors = [] 

    // d3.json("student_data.json", function(data){
        // debugger;
        x_labels = student_data.x_labels;
        y_labels = student_data.y_labels;
        colors.push(student_data.color_scheme.color_1);
        colors.push(student_data.color_scheme.color_2);
        colors.push(student_data.color_scheme.color_3);
        content = student_data.content;
        scores_per_student = get_scores_for_each_student(content);  // <student, array of scores>
        average_per_student = get_avg_scores_per_student(scores_per_student);
     //    variance_per_student =  get_variance_per_student(scores_per_student, average_per_student) ;

        // The main chart
        // var myChart = new dimple.chart(svg, studentData);
        // The chart to show in a tooltip
        var tipChart = null;
        // The other popup shapes
        var popup = null;

        // Position the main chart
        // myChart.setBounds(60, 40, 500, 320);
      
        // Add the main chart axes
        // var x = myChart.addCategoryAxis("x", x_labels);
        // var y = myChart.addCategoryAxis("y", y_labels);
        // var z = myChart.addMeasureAxis("z", scores_per_student);
        // var s = myChart.addSeries(null, dimple.plot.bubble);
        // myChart.draw();



    // });

    function get_scores_for_each_student(content){
        // Map storing scores for each student, key is student, value is an array of scores for that student.
        var scores_per_student = {} ;
        var temp_scores = [] ;

        for (var i = 0; i < content.length; i++) { //Iterates over each student
            for (var j = 0; j < content[i].length; j++) { // iterate over scores of each student.
                temp_scores.push(content[i][j].score);
            }
            scores_per_student[y_labels[i]] = temp_scores ;
        }
        // debugger;
        return scores_per_student;
    }

    function get_avg_scores_per_student(scores_per_student){

        var sum = 0 ;
        var avg = 0.0 ;
        for( var i = '' ; i < scores_per_student.length; i++ )
        {
            sum = sum + scores_per_student[y_labels[i]];
        }
        debugger;
        avg =  sum/scores_per_student.length ;
        return avg ;
    }

    function get_variance_per_student(scores_per_student, average_per_student){

        var sum = 0.0 ;
        var variance = 0.0 ;

        for( var i = 0 ; i < scores_per_student.length; i++ )
        {
            sum = sum + Math.pow(scores_per_student[i]- average_per_student[i]);
        }

        variance =  sum/(scores_per_student.length -1);
        return variance ;
    }


</script>
</body>
</html>
